<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- base should be inside head -->
  <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@0e4ecd6d318272b62cd671011d5afe60aec66321/wrestle%20bros/">
  <title>Wrestle Bros ðŸŽ® Play</title>
  <meta name="description" content="Online multiplayer PRO WRESTLING! Beat up your bros!" />
  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="shortcut icon" type="image/png" href="./favicon.png">
  <meta name="keywords" content="Wrestling, Play, Free, Online, Multiplayer, Games, IO, Fighting, Slam, Scrolling, Friends">
  <meta name="author" content="Blue Wizard Digital">
  <link rel="manifest" href="manifest.json">

  <script type="text/javascript" src="WrestleBros.js?th=676"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      background: #000;
      color: orange;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    /* hide scrollbars for webkit */
    .body::-webkit-scrollbar { width: 0px; }

    #openfl-content {
      background: #000;
      width: 100%;
      height: 100%;
    }

    #spinner {
      transform-origin: 50% 50%;
      width: 82px;
      height: 81px;
      animation: spin1 2s infinite linear;
    }

    /* simple responsive helper for the preroll container */
    #preroll { display: none; position: absolute; z-index: 100; top: 50%; left: 50%; transform: translate(-50%, -50%); }

    /* small utility for info boxes */
    .info-box { background: rgba(255,255,255,0.03); padding: 12px; margin: 8px; border-radius: 6px; color: #ddd; max-width: 980px; }
    .section { padding: 8px; }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9WFJGF6YNK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-9WFJGF6YNK', { cookie_flags: 'secure;samesite=none' });
  </script>

  <!-- other tag include (kept as-is) -->
  <script> /* Interstitial ad available event (kept) */ 
    document.addEventListener("aip_interstitialadavailable", function(e) { console.log("An interstitial ad is available"); });
  </script>
  <script src="tag.min.js" defer></script>
</head>

<body style="overflow:hidden;">
  <!-- hidden audio iframe to allow autoplay init -->
  <iframe src="silence.mp3" allow="autoplay" id="audio" style="display:none" aria-hidden="true"></iframe>
  <noscript>Enable JavaScript bro!</noscript>

  <div id="loading" style="position:absolute; z-index:15; top:60%; left:50%; transform:translate(-50%,0); background:#000;">
    <center>
      <img src="assets/loading4.png" alt="loading" />
      <br />
      <img src="assets/fbro.png" alt="fbro" />
      <img src="assets/sbro.png" alt="sbro" />
      <img src="assets/wbro.png" alt="wbro" />
      <img src="assets/bbro.png" alt="bbro" />
    </center>
  </div>

  <div id="game2" style="width:100%; height:100%;">
    <div id="openfl-content" onblur="window.focus();" style="width:100%; float:left;">
      <script type="text/javascript">
        // keep lime.embed call (assumes lime is defined by WrestleBros.js)
        if (typeof lime !== 'undefined' && lime.embed) {
          lime.embed("WrestleBros", "openfl-content", 0, 0, { parameters: {} });
        } else {
          // if lime isn't ready yet, attempt to call it later
          window.addEventListener('load', function(){ if(typeof lime !== 'undefined' && lime.embed) lime.embed("WrestleBros", "openfl-content", 0, 0, { parameters: {} }); });
        }
      </script>
    </div>

    <div id="preroll" style="width:960px; height:540px;"></div>

    <!-- ad containers (kept) -->
    <div id="wrestlebros-io_300x250" style="width:300px; height:250px; display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
    <div id="wrestlebros-io_300x250_2" style="width:300px; height:250px; display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
    <div id="wrestlebros-io_728x90" style="display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
    <div id="wrestlebros-io_728x90_m" style="display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
    <div id="wrestlebros-io_970x250" style="display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
    <div id="wrestlebros-io_160x600" style="width:160px; height:600px; display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
    <div id="wrestlebros-io_160x600_2" style="width:160px; height:600px; display:none; position:absolute; top:30px; left:30px; z-index:100; overflow:hidden;"></div>
  </div>

  <br />

  <div id="more">
    <div class="notch-top-left" style="--notch-color: var(--background-color)"></div>

    <div class="info-box">
      <h3>About Wrestle Bros</h3>
      <p>Body slam your bros in this free pro wrestling browser game from Blue Wizard! Play games against your friends online or wrestle the CPU to unlock new wrestlers and gear. Let's get ready to rumble in the ultimate cage match! Fly off the top rope, smash your opponent into the canvas, or even bounce off the ropes! Best of all, you can play online vs your friends, bro!</p>
      <p>The controls are very simple: Use either the arrow keys or WASD to control your wrestler. Jump by pressing the up arrow, and double jump to pin. Enter/Space will attack in different ways, depending on what the situation is.</p>
      <p>Be sure to sign up for our newsletter to know alt links and new updates to Wrestle Bros!</p>
    </div>

    <div class="info-box">
      <h3>FAQ</h3>
      <b>Why isn't the game loading?</b>
      <p>Check your internet connection, ensure the site isn't blocked, and try disabling ad blockers.</p>
      <b>How do I play?</b>
      <p>Just hop in and start suplexing your bros!</p>
      <b>Which browser should I use?</b>
      <p>Chrome is recommended. The game has been tested on Firefox and Safari as well.</p>
      <b>Are there more Bros games?</b>
      <p>Yes! Our newest is <a href="https://footballbros.io" target="_blank" rel="noopener">Football Bros</a>. Also check <a href="https://soccerbros.gg" target="_blank" rel="noopener">Soccer Bros</a> and <a href="https://basketbros.io" target="_blank" rel="noopener">Basket Bros</a>.</p>
    </div>
  </div>

  <div class="section">
    <div style="display:flex; flex-direction:row; flex-wrap:wrap; margin:10px; padding:2px; justify-content:center;">
      <div class="partner">
        <script>
          function getPartner(y) {
            var referrer = document.referrer || '';
            if (referrer.includes('crazygames')) {
              return '<center><br><div style="transform:translate(' + '-50' + 'px,' + y + 'px); width=70%; z-index:101; text-align:right;"><font style="font-weight:normal;font-family:Arial;color:#010101;font-size:20px;"><a href="https://crazygames.com" target="_blank" rel="noopener">Crazy Games</a></font><br></div></center>';
            } else if (referrer.includes('iogames.space')) {
              return '<center><br><div style="transform:translate(' + '-50' + 'px,' + y + 'px); width=70%; z-index:101; text-align:right;"><font style="font-weight:normal;font-family:Arial;color:#010101;font-size:20px;"><a href="https://iogames.space" target="_blank" rel="noopener">IO Games</a></font><br></div></center>';
            } else if (referrer.includes('poki')) {
              return '<center><br><div style="transform:translate(' + '-50' + 'px,' + y + 'px); width=70%; z-index:101; text-align:right;"><font style="font-weight:normal;font-family:Arial;color:#010101;font-size:20px;">Check out our friends at <a href="https://poki.com" target="_blank" rel="noopener">Poki</a></font><br></div></center>';
            } else if (referrer.includes('silver')) {
              return '<center><br><div style="transform:translate(' + '-50' + 'px,' + y + 'px); width=70%; z-index:101; text-align:right;"><font style="font-weight:normal;font-family:Arial;color:#010101;font-size:20px;"><a href="https://silvergames.com" target="_blank" rel="noopener">Silver Games</a></font><br></div></center>';
            } else if (referrer === '') {
              return '<center><br><div style="transform:translate(' + '-50' + 'px,' + y + 'px); width=70%; z-index:101; text-align:right;"><font style="font-weight:normal;font-family:Arial;color:#010101;font-size:20px;"><a href="https://freegames.io/game/wrestle-bros" target="_blank" rel="noopener">Wrestle Bros at Freegames.io</a><br/><a href="https://crazygames.com" target="_blank" rel="noopener">Crazy Games</a></font><br></div></center>';
            } else {
              return '<center><br><div style="transform:translate(' + '-50' + 'px,' + y + 'px); width=70%; z-index:101; text-align:right;"><font style="font-weight:normal;font-family:Arial;color:#010101;font-size:20px;"><a href="https://freegames.io/game/wrestle-bros" target="_blank" rel="noopener">Wrestle Bros at Freegames.io</a></font><br></div></center>';
            }
          }
          document.write(getPartner(0));
        </script>
      </div>
    </div>
  </div>

  <script>
    /* ========== Safe DOM wiring and utility improvements ========== */

    // Helper to safely call a function when DOM is ready
    function onReady(fn) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', fn);
      } else {
        fn();
      }
    }

    onReady(function(){
      // guard for elements which may not exist depending on how the page is embedded
      var openfl = document.getElementById('openfl-content');
      if (openfl) {
        openfl.addEventListener('wheel', doScroll, { passive: true });
        openfl.focus && openfl.focus();
      }

      var more = document.getElementById('more');
      if (more) {
        more.addEventListener('wheel', doScroll, { passive: true });
      }

      // keep scroll pinned to top every 2 seconds (kept from your original logic)
      setInterval(function(){ window.scrollTo(0,0); }, 2000);

      // initial status update (safe check)
      try { updateStatus(true); } catch (e) { console.warn('updateStatus unavailable', e); }
    });

    function doScroll(event) {
      // simple vertical scroll behavior mapping
      window.scrollTo(0, window.scrollY + (event && event.deltaY ? event.deltaY : 0));
    }

    // --- all other functions left mostly unchanged, but guarded where needed ---

    var deferredPrompt;
    var testedPWA = false;
    var canProcessPWA = false;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      canProcessPWA = true;
    });

    function CheckPWA() {
      if (testedPWA) return;
      if (typeof gCrazySDK !== 'undefined') return;

      testedPWA = true;
      if (window.matchMedia('(display-mode: standalone)').matches) {
        SendEvent('event','in_pwa');
      } else if (canProcessPWA) {
        SendEvent('event','not_in_pwa');
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') console.log('User accepted the install prompt');
          else console.log('User dismissed the install prompt');
        });
      } else {
        SendEvent('event','pwa_not_installed');
      }
    }

    // ad-related scaffolding (kept, minor safety guards)
    var aiptag = window.aiptag || {};
    aiptag.cmd = aiptag.cmd || [];
    aiptag.cmd.player = aiptag.cmd.player || [];
    aiptag.consented = false;

    aiptag.cmd.player.push(function() {
      if (typeof aipPlayer === 'undefined') return;
      adplayer = new aipPlayer({
        AIP_ADBREAK_COMPLETE: function(){ Main.DoneInterstitialAd(false); },
        AD_WIDTH: 960,
        AD_HEIGHT: 540,
        AD_DISPLAY: 'default',
        TRUSTED: true,
        LOADING_TEXT: 'loading advertisement',
        PREROLL_ELEM: function(){ return document.getElementById('preroll'); },
        AIP_COMPLETE: function(state){
          Main.DoneVideoAd && Main.DoneVideoAd();
          window.focus();
          try { document.getElementById('openfl-content').focus(); } catch(e){}
          if (state == null) state = 'null';
          SendEvent('event','donevideo-' + (window.lastUnitPlayed||'') + "-" + state);
        },
        AIP_REMOVE: function(){ /* optional */ }
      });
    });

    // show video helper (kept logic, small guard)
    function ShowVideo(theUnitName = null, forceaip = false) {
      console.log('SHOW_VIDEO');
      var aUnitName = "";
      if (/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)) {
        var l = document.getElementById('preroll');
        if (!l) return;
        l.style.display = 'none';
        l.style.visibility = 'hidden';
        window.focus();
        try { document.getElementById('openfl-content').focus(); } catch(e){}
        Main.DoneVideoAd && Main.DoneVideoAd();
        return;
      }

      if (typeof $msstart !== 'undefined' && forceaip == false) {
        $msstart.showAdsAsync(msAdID).then(adInstance => {
          adInstance.showAdsCompletedAsync.then(() => {
            Main.DoneVideoAd && Main.DoneVideoAd();
            window.focus();
            try { document.getElementById('openfl-content').focus(); } catch(e){}
            SendEvent('event','ms_video_shown2');
            LoadVideo();
          }).catch((err) => { SendEvent('event','ms_video_not_completed'); LoadVideo(); });
        }).catch((err) => { console.log('Ms Video Ad Error, showing aip'); SendEvent('event','ms_video_show_error2'); LoadVideo(); ShowVideo(theUnitName, true); });
      } else if (typeof window.CrazyGames !== 'undefined') {
        const callbacks = { adFinished: () => Main.DoneVideoAd && Main.DoneVideoAd(), adError: (error) => Main.DoneVideoAd && Main.DoneVideoAd(), adStarted: () => console.log("Start midgame ad") };
        window.CrazyGames.SDK.ad.requestAd("midgame", callbacks);
        SendEvent('event','cgvideo');
        return;
      } else if (typeof adplayer === 'undefined') {
        Main.DoneVideoAd && Main.DoneVideoAd(true);
        SendEvent('event','video_adblocked');
      } else {
        var aStr = theUnitName || 'preroll';
        window.lastUnitPlayed = aStr;
        SendEvent('event','startvideo-' + aStr);
        aiptag.cmd.player.push(function(){ adplayer.startPreRoll(theUnitName); });
      }
    }

    // Utility functions and event sending
    var sid = 'k0kkssjs5cb8v9vf5s71gsdss0';
    function updateStatus(fromEvent = false) {
      try {
        const req = new XMLHttpRequest();
        var aStr = "recordsession.php?s=" + sid;
        if (fromEvent) aStr += "&e=1";
        req.open("GET", aStr);
        req.send();
      } catch (e) { console.warn('updateStatus failed', e); }
    }

    function SendEvent(theEvent, theAction, theParms = '') {
      try {
        if (theParms === '') gtag(theEvent, theAction);
        else gtag(theEvent, theAction, theParms);
      } catch (e) { /* gtag may not be defined */ }
      updateStatus(true);
    }

    // keep some of your original interval/behaviors (safe)
    setInterval(function(){ window.scrollTo(0,0); }, 2000);

    function EmailSignup() {
      if (document.getElementById("signup") || document.getElementById("deleteme")) return;
      const iframe = document.createElement("iframe");
      iframe.src = "https://bluewizard.com/subscribe-to-bbros/";
      iframe.style.width = "550px";
      iframe.style.height = (window.innerHeight - 100) + "px";
      iframe.style.position = "absolute";
      iframe.style.top = "50px";
      iframe.style.left = "50%";
      iframe.style.marginLeft = "-225px";
      iframe.style.maxWidth = "100%";
      iframe.id = "signup";
      document.body.appendChild(iframe);
    }

    // Gameplay events
    function GamePlayStart(){ if (typeof window.CrazyGames !== 'undefined') window.CrazyGames.SDK.game.gameplayStart(); }
    function GamePlayStop(){ if (typeof window.CrazyGames !== 'undefined') window.CrazyGames.SDK.game.gameplayStop(); }
    function HappyTime(){ if (typeof window.CrazyGames !== 'undefined') window.CrazyGames.SDK.game.happytime(); }

    // Attempt initial updateStatus safely
    try { updateStatus(true); } catch (e) { console.warn('initial updateStatus failed', e); }
  </script>
</body>
</html>
